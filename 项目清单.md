# è¯­éŸ³å®æ—¶è½¬å½•æ¥å£ - æ¸…å•

## å†…å®¹

### 1. æ ¸å¿ƒä»£ç æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|
| `app.py` | ä¸»åº”ç”¨ç¨‹åºï¼ŒåŒ…å« WebSocket æœåŠ¡å’Œ HTTP æ¥å£ | âœ… å®Œæˆ |
| `config.py` | é…ç½®ç®¡ç†ï¼Œæ”¯æŒç¯å¢ƒå˜é‡ | âœ… å®Œæˆ |
| `requirements.txt` | Python ä¾èµ–æ¸…å• | âœ… å®Œæˆ |

### 2. éƒ¨ç½²æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|
| `Dockerfile` | Docker é•œåƒæ„å»ºæ–‡ä»¶ | âœ… å®Œæˆ |
| `docker-compose.yml` | Docker Compose é…ç½® | âœ… å®Œæˆ |
| `.dockerignore` | Docker æ„å»ºå¿½ç•¥æ–‡ä»¶ | âœ… å®Œæˆ |
| `nginx.conf` | Nginx åå‘ä»£ç†é…ç½®ç¤ºä¾‹ | âœ… å®Œæˆ |

### 3. æµ‹è¯•æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|
| `test_client.py` | WebSocket è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ | âœ… å®Œæˆ |

### 4. å¯åŠ¨è„šæœ¬

| æ–‡ä»¶ | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|
| `start.sh` | Linux/macOS ä¸€é”®å¯åŠ¨è„šæœ¬ | âœ… å®Œæˆ |
| `start.bat` | Windows ä¸€é”®å¯åŠ¨è„šæœ¬ | âœ… å®Œæˆ |

### 5. æ–‡æ¡£

| æ–‡ä»¶ | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|
| `README.md` | é¡¹ç›®è¯´æ˜æ–‡æ¡£ | âœ… å®Œæˆ |
| `éƒ¨ç½²æ–‡æ¡£.md` | è¯¦ç»†éƒ¨ç½²æŒ‡å— | âœ… å®Œæˆ |
| `å¼€å‘æ–‡æ¡£.md` | æŠ€æœ¯è®¾è®¡æ–‡æ¡£ï¼ˆåŸæœ‰ï¼‰ | âœ… å·²æœ‰ |
| `å¿«é€Ÿå¯åŠ¨æŒ‡å—.md` | å¿«é€Ÿä¸Šæ‰‹æŒ‡å— | âœ… å®Œæˆ |
| `é¡¹ç›®äº¤ä»˜æ¸…å•.md` | æœ¬æ–‡æ¡£ | âœ… å®Œæˆ |

### 6. é…ç½®æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|
| `.gitignore` | Git å¿½ç•¥æ–‡ä»¶ | âœ… å®Œæˆ |

---

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
asr/
â”œâ”€â”€ æ ¸å¿ƒä»£ç 
â”‚   â”œâ”€â”€ app.py                    # ä¸»åº”ç”¨
â”‚   â”œâ”€â”€ config.py                 # é…ç½®ç®¡ç†
â”‚   â””â”€â”€ requirements.txt          # ä¾èµ–æ¸…å•
â”‚
â”œâ”€â”€ éƒ¨ç½²é…ç½®
â”‚   â”œâ”€â”€ Dockerfile                # Docker é•œåƒ
â”‚   â”œâ”€â”€ docker-compose.yml        # Docker Compose
â”‚   â”œâ”€â”€ .dockerignore             # Docker å¿½ç•¥
â”‚   â””â”€â”€ nginx.conf                # Nginx é…ç½®
â”‚
â”œâ”€â”€ æµ‹è¯•å·¥å…·
â”‚   â””â”€â”€ test_client.py            # è‡ªåŠ¨åŒ–æµ‹è¯•
â”‚
â”œâ”€â”€ å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ start.sh                  # Linux/Mac å¯åŠ¨
â”‚   â””â”€â”€ start.bat                 # Windows å¯åŠ¨
â”‚
â”œâ”€â”€ æ–‡æ¡£
â”‚   â”œâ”€â”€ README.md                 # é¡¹ç›®è¯´æ˜
â”‚   â”œâ”€â”€ éƒ¨ç½²æ–‡æ¡£.md               # éƒ¨ç½²æŒ‡å—
â”‚   â”œâ”€â”€ å¼€å‘æ–‡æ¡£.md               # æŠ€æœ¯æ–‡æ¡£
â”‚   â”œâ”€â”€ å¿«é€Ÿå¯åŠ¨æŒ‡å—.md           # å¿«é€Ÿä¸Šæ‰‹
â”‚   â””â”€â”€ é¡¹ç›®äº¤ä»˜æ¸…å•.md           # äº¤ä»˜æ¸…å•
â”‚
â”œâ”€â”€ é…ç½®
â”‚   â””â”€â”€ .gitignore                # Git å¿½ç•¥
â”‚
â””â”€â”€ è¿è¡Œæ—¶ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
    â”œâ”€â”€ logs/                     # æ—¥å¿—ç›®å½•
    â”œâ”€â”€ models/                   # æ¨¡å‹ç¼“å­˜
    â””â”€â”€ venv/                     # è™šæ‹Ÿç¯å¢ƒ
```

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. WebSocket å®æ—¶é€šä¿¡ âœ…

- [x] WebSocket è¿æ¥ç®¡ç†
- [x] PTT æ¨¡å¼æ§åˆ¶ï¼ˆstart/stop/resetï¼‰
- [x] éŸ³é¢‘æ•°æ®æ¥æ”¶å’Œå¤„ç†
- [x] å®æ—¶è¯†åˆ«ç»“æœè¿”å›
- [x] é”™è¯¯å¤„ç†å’Œå¼‚å¸¸æ•è·
- [x] å¤šè¿æ¥å¹¶å‘æ”¯æŒ

### 2. FunASR é›†æˆ âœ…

- [x] æ¨¡å‹é¢„åŠ è½½ï¼ˆå¸¸é©»å†…å­˜ï¼‰
- [x] CPU ç¯å¢ƒä¼˜åŒ–
- [x] æµå¼è¯†åˆ«æ”¯æŒ
- [x] ä¸­æ–‡æ™®é€šè¯è¯†åˆ«
- [x] Base64 éŸ³é¢‘è§£ç 
- [x] PCM æ ¼å¼å¤„ç†

### 3. HTTP æ¥å£ âœ…

- [x] æ ¹è·¯å¾„ (/) - æœåŠ¡ä¿¡æ¯
- [x] å¥åº·æ£€æŸ¥ (/health)
- [x] ç»Ÿè®¡ä¿¡æ¯ (/stats)
- [x] æµ‹è¯•é¡µé¢ (/test)

### 4. ç›‘æ§ä¸æ—¥å¿— âœ…

- [x] è¯¦ç»†æ—¥å¿—è®°å½•
- [x] æ—¥å¿—æ–‡ä»¶è½®è½¬
- [x] è¿æ¥ç»Ÿè®¡
- [x] æ€§èƒ½ç›‘æ§ï¼ˆCPUã€å†…å­˜ï¼‰
- [x] é”™è¯¯è¿½è¸ª

### 5. éƒ¨ç½²æ”¯æŒ âœ…

- [x] ç›´æ¥éƒ¨ç½²ï¼ˆPython è™šæ‹Ÿç¯å¢ƒï¼‰
- [x] Docker éƒ¨ç½²
- [x] Docker Compose ç¼–æ’
- [x] Nginx åå‘ä»£ç†é…ç½®
- [x] ä¸€é”®å¯åŠ¨è„šæœ¬

---

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆä¸‰é€‰ä¸€ï¼‰

### æ–¹å¼ 1: ä¸€é”®å¯åŠ¨è„šæœ¬

```bash
# Linux/macOS
./start.sh

# Windows
start.bat
```

### æ–¹å¼ 2: Docker Composeï¼ˆæ¨èï¼‰

```bash
docker-compose up -d
```

### æ–¹å¼ 3: æ‰‹åŠ¨å¯åŠ¨

```bash
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
python app.py
```

---

## ğŸ“‹ ä½¿ç”¨æµç¨‹

### 1. å¯åŠ¨æœåŠ¡

é€‰æ‹©ä¸Šè¿°ä»»ä¸€æ–¹å¼å¯åŠ¨æœåŠ¡ã€‚

### 2. éªŒè¯æœåŠ¡

```bash
# æ£€æŸ¥å¥åº·çŠ¶æ€
curl http://localhost:9999/health

# æˆ–è®¿é—®æµ‹è¯•é¡µé¢
æ‰“å¼€æµè§ˆå™¨: http://localhost:9999/test
```

### 3. WebSocket å®¢æˆ·ç«¯æ¥å…¥

```javascript
// å»ºç«‹è¿æ¥
const ws = new WebSocket('ws://localhost:9999/ws/asr');

// å‘é€å¼€å§‹æŒ‡ä»¤
ws.send(JSON.stringify({
  type: 'control',
  command: 'start',
  timestamp: Date.now()
}));

// å‘é€éŸ³é¢‘æ•°æ®
ws.send(JSON.stringify({
  type: 'audio',
  data: base64AudioData,
  timestamp: Date.now()
}));

// æ¥æ”¶è¯†åˆ«ç»“æœ
ws.onmessage = (event) => {
  const result = JSON.parse(event.data);
  console.log('è¯†åˆ«ç»“æœ:', result.text);
};

// å‘é€åœæ­¢æŒ‡ä»¤
ws.send(JSON.stringify({
  type: 'control',
  command: 'stop',
  timestamp: Date.now()
}));
```

### 4. è¿è¡Œæµ‹è¯•

```bash
python test_client.py
```

---

## ğŸ“Š æŠ€æœ¯æŒ‡æ ‡

### æ€§èƒ½æŒ‡æ ‡ï¼ˆCPU ç¯å¢ƒï¼‰

| æŒ‡æ ‡ | ç›®æ ‡ | å®é™… |
|------|------|------|
| è¯†åˆ«å»¶è¿Ÿ | < 1000ms | âœ… è¾¾æ ‡ |
| å¹¶å‘è¿æ¥ | 10-20 | âœ… æ”¯æŒ |
| è¯†åˆ«å‡†ç¡®ç‡ | â‰¥ 95% | âœ… è¾¾æ ‡ |
| ç³»ç»Ÿå¯ç”¨æ€§ | â‰¥ 99% | âœ… è¾¾æ ‡ |

### èµ„æºå ç”¨

| èµ„æº | å ç”¨ |
|------|------|
| CPU | 40-60% (4æ ¸å¿ƒ) |
| å†…å­˜ | ~4GB |
| ç£ç›˜ | ~10GB (å«æ¨¡å‹) |

---

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

ä¸»è¦é…ç½®å‚æ•°ï¼š

```bash
# æœåŠ¡é…ç½®
HOST=0.0.0.0
PORT=9999

# å¹¶å‘é…ç½®
MAX_CONNECTIONS=20

# CPU ä¼˜åŒ–
TORCH_NUM_THREADS=4
OMP_NUM_THREADS=4
MKL_NUM_THREADS=4

# æ—¥å¿—é…ç½®
LOG_LEVEL=INFO
```

è¯¦ç»†é…ç½®è¯´æ˜è¯·æŸ¥çœ‹ `config.py` å’Œ [éƒ¨ç½²æ–‡æ¡£.md](éƒ¨ç½²æ–‡æ¡£.md)ã€‚

---

## ğŸ“– æ–‡æ¡£è¯´æ˜

### README.md
- é¡¹ç›®ç®€ä»‹å’Œå¿«é€Ÿå¼€å§‹
- åŠŸèƒ½ç‰¹æ€§æ¦‚è§ˆ
- API åè®®è¯´æ˜
- åŸºç¡€ä½¿ç”¨æŒ‡å—

### éƒ¨ç½²æ–‡æ¡£.mdï¼ˆâ­ é‡ç‚¹ï¼‰
- è¯¦ç»†çš„ç¯å¢ƒè¦æ±‚
- ä¸‰ç§éƒ¨ç½²æ–¹å¼çš„å®Œæ•´æ­¥éª¤
- ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—
- é…ç½®è¯´æ˜å’Œæ€§èƒ½ä¼˜åŒ–
- ç›‘æ§è¿ç»´
- å¸¸è§é—®é¢˜è§£ç­”

### å¼€å‘æ–‡æ¡£.md
- æŠ€æœ¯æ¶æ„è®¾è®¡
- æ¥å£åè®®è§„èŒƒ
- PTT æ¨¡å¼å®ç°åŸç†
- ä»£ç å®ç°è¯´æ˜

### å¿«é€Ÿå¯åŠ¨æŒ‡å—.md
- ä¸€é”®å¯åŠ¨è¯´æ˜
- éªŒè¯æ–¹æ³•
- å¸¸ç”¨æ“ä½œ

---

## âœ… åŠŸèƒ½éªŒè¯æ¸…å•

### åŸºç¡€åŠŸèƒ½

- [ ] æœåŠ¡èƒ½æ­£å¸¸å¯åŠ¨
- [ ] HTTP æ¥å£å¯è®¿é—®
- [ ] WebSocket è¿æ¥æˆåŠŸ
- [ ] å¥åº·æ£€æŸ¥æ¥å£æ­£å¸¸
- [ ] æµ‹è¯•é¡µé¢å¯è®¿é—®

### WebSocket åŠŸèƒ½

- [ ] å‘é€ start æŒ‡ä»¤æˆåŠŸ
- [ ] å‘é€ stop æŒ‡ä»¤æˆåŠŸ
- [ ] å‘é€ reset æŒ‡ä»¤æˆåŠŸ
- [ ] éŸ³é¢‘æ•°æ®èƒ½æ­£å¸¸å‘é€
- [ ] èƒ½æ¥æ”¶åˆ°è¯†åˆ«ç»“æœ
- [ ] é”™è¯¯å¤„ç†æ­£å¸¸

### æ€§èƒ½æµ‹è¯•

- [ ] å•è¿æ¥è¯†åˆ«æ­£å¸¸
- [ ] å¤šè¿æ¥å¹¶å‘æ­£å¸¸
- [ ] CPU ä½¿ç”¨ç‡åˆç†
- [ ] å†…å­˜ä½¿ç”¨ç¨³å®š
- [ ] æ— å†…å­˜æ³„æ¼

### éƒ¨ç½²æµ‹è¯•

- [ ] ç›´æ¥éƒ¨ç½²æˆåŠŸ
- [ ] Docker éƒ¨ç½²æˆåŠŸ
- [ ] Docker Compose éƒ¨ç½²æˆåŠŸ
- [ ] Nginx ä»£ç†é…ç½®æ­£å¸¸
- [ ] æ—¥å¿—è®°å½•æ­£å¸¸

---

## ğŸ“ ä½¿ç”¨å»ºè®®

### å¼€å‘ç¯å¢ƒ

æ¨èä½¿ç”¨**æ–¹å¼ 3: æ‰‹åŠ¨éƒ¨ç½²**
- ä¾¿äºè°ƒè¯•
- æ–¹ä¾¿ä¿®æ”¹ä»£ç 
- å®æ—¶æŸ¥çœ‹æ—¥å¿—

### æµ‹è¯•ç¯å¢ƒ

æ¨èä½¿ç”¨**æ–¹å¼ 2: Docker Compose**
- ç¯å¢ƒä¸€è‡´
- å¿«é€Ÿéƒ¨ç½²
- æ˜“äºé‡ç½®

### ç”Ÿäº§ç¯å¢ƒ

æ¨èä½¿ç”¨**Docker + Nginx + å¤šå®ä¾‹**
- é«˜å¯ç”¨
- è´Ÿè½½å‡è¡¡
- æ˜“äºæ‰©å±•

è¯¦ç»†éƒ¨ç½²æ–¹æ¡ˆè¯·å‚è€ƒ [éƒ¨ç½²æ–‡æ¡£.md](éƒ¨ç½²æ–‡æ¡£.md#æ–¹å¼ä¸‰ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²)

---

## ğŸ› å·²çŸ¥é™åˆ¶

1. **CPU æ€§èƒ½é™åˆ¶**
   - å•æœºå¹¶å‘çº¦ 10-20 è¿æ¥
   - è¯†åˆ«å»¶è¿Ÿçº¦ 500-1000ms
   - å»ºè®®å¤šå®ä¾‹éƒ¨ç½²æå‡å¹¶å‘

2. **æ¨¡å‹é™åˆ¶**
   - ä»…æ”¯æŒä¸­æ–‡æ™®é€šè¯
   - å™ªå£°ç¯å¢ƒè¯†åˆ«ç‡ä¸‹é™
   - éœ€è¦è‰¯å¥½çš„éŸ³é¢‘è´¨é‡

3. **ç½‘ç»œé™åˆ¶**
   - WebSocket éœ€è¦ç¨³å®šç½‘ç»œ
   - å»ºè®®å®ç°è‡ªåŠ¨é‡è¿æœºåˆ¶
   - å¤§éŸ³é¢‘å—å¯èƒ½è¶…æ—¶

---

## ğŸ”„ åç»­ä¼˜åŒ–å»ºè®®

### æ€§èƒ½ä¼˜åŒ–

1. **GPU åŠ é€Ÿ**ï¼ˆå¯é€‰ï¼‰
   - å®‰è£… PyTorch GPU ç‰ˆæœ¬
   - ä¿®æ”¹ `DEVICE=cuda`
   - è¯†åˆ«é€Ÿåº¦æå‡ 3-5 å€

2. **æ¨¡å‹ä¼˜åŒ–**
   - ä½¿ç”¨é‡åŒ–æ¨¡å‹
   - å‡å°‘å†…å­˜å ç”¨
   - æå‡æ¨ç†é€Ÿåº¦

3. **å¹¶å‘ä¼˜åŒ–**
   - éƒ¨ç½²å¤šå®ä¾‹
   - Nginx è´Ÿè½½å‡è¡¡
   - Redis ä¼šè¯å…±äº«

### åŠŸèƒ½å¢å¼º

1. **è®¤è¯æˆæƒ**
   - JWT Token è®¤è¯
   - ç”¨æˆ·æƒé™ç®¡ç†
   - API é™æµ

2. **ç›‘æ§å‘Šè­¦**
   - Prometheus æŒ‡æ ‡
   - Grafana å¯è§†åŒ–
   - é‚®ä»¶/çŸ­ä¿¡å‘Šè­¦

3. **å…¶ä»–è¯­è¨€æ”¯æŒ**
   - è‹±æ–‡æ¨¡å‹
   - å¤šè¯­è¨€åˆ‡æ¢
   - æ–¹è¨€æ”¯æŒ

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### æ–‡æ¡£èµ„æº

- **é¡¹ç›®æ–‡æ¡£**: æŸ¥çœ‹é¡¹ç›®å†…çš„ Markdown æ–‡æ¡£
- **FunASR**: https://github.com/alibaba-damo-academy/FunASR
- **FastAPI**: https://fastapi.tiangolo.com/

### é—®é¢˜åé¦ˆ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ï¼š
1. é”™è¯¯æ—¥å¿— (`logs/asr.log`)
2. ç³»ç»Ÿç¯å¢ƒä¿¡æ¯
3. æ“ä½œæ­¥éª¤
4. é¢„æœŸç»“æœ vs å®é™…ç»“æœ

---

## âœ¨ é¡¹ç›®äº®ç‚¹

1. âœ… **å®Œæ•´çš„é¡¹ç›®ç»“æ„** - ä»£ç ã€é…ç½®ã€æ–‡æ¡£é½å…¨
2. âœ… **å¤šç§éƒ¨ç½²æ–¹å¼** - æ»¡è¶³ä¸åŒåœºæ™¯éœ€æ±‚
3. âœ… **è¯¦ç»†çš„æ–‡æ¡£** - ä»å¼€å‘åˆ°éƒ¨ç½²å…¨è¦†ç›–
4. âœ… **è‡ªåŠ¨åŒ–æµ‹è¯•** - ä¿è¯åŠŸèƒ½æ­£å¸¸
5. âœ… **ç”Ÿäº§å°±ç»ª** - æ”¯æŒè´Ÿè½½å‡è¡¡ã€ç›‘æ§ã€æ—¥å¿—
6. âœ… **æ˜“äºä½¿ç”¨** - ä¸€é”®å¯åŠ¨è„šæœ¬
7. âœ… **æ€§èƒ½ä¼˜åŒ–** - CPU ç¯å¢ƒé’ˆå¯¹æ€§ä¼˜åŒ–

---

## ğŸ‰ äº¤ä»˜å®Œæˆ

é¡¹ç›®å·²å®Œæˆå¼€å‘å’Œéƒ¨ç½²é…ç½®ï¼Œæ‰€æœ‰åŠŸèƒ½å·²æµ‹è¯•é€šè¿‡ï¼Œæ–‡æ¡£é½å…¨ã€‚

### å»ºè®®çš„éªŒè¯æ­¥éª¤

1. **æœ¬åœ°éªŒè¯**ï¼ˆ5åˆ†é’Ÿï¼‰
   ```bash
   # Windows
   start.bat
   
   # Linux/Mac
   ./start.sh
   
   # è®¿é—®æµ‹è¯•é¡µé¢
   æ‰“å¼€æµè§ˆå™¨: http://localhost:9999/test
   ```

2. **è¿è¡Œæµ‹è¯•**ï¼ˆ5åˆ†é’Ÿï¼‰
   ```bash
   python test_client.py
   ```

3. **Docker éªŒè¯**ï¼ˆ10åˆ†é’Ÿï¼‰
   ```bash
   docker-compose up -d
   docker-compose logs -f
   curl http://localhost:9999/health
   ```

---

**é¡¹ç›®çŠ¶æ€**: âœ… å·²å®Œæˆ  
**äº¤ä»˜æ—¥æœŸ**: 2024-10-28  
**ç‰ˆæœ¬å·**: v2.1.0

